<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Udlejning Pro</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <style>
        :root { --primary: #5856D6; --success: #34C759; --danger: #FF3B30; --bg: #F2F2F7; --card: #FFFFFF; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 0; color: #1C1C1E; }
        .view { display: none; padding: 20px; padding-bottom: 100px; }
        .active { display: block; }
        .stat-card { background: var(--card); padding: 15px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 15px; }
        .stat-label { font-size: 12px; color: #8E8E93; text-transform: uppercase; }
        .stat-value { font-size: 22px; font-weight: bold; margin-top: 5px; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .menu-btn { background: var(--card); border: none; padding: 20px; border-radius: 20px; font-size: 14px; font-weight: 600; display: flex; flex-direction: column; align-items: center; gap: 10px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border-radius: 10px; border: 1px solid #DDD; font-size: 16px; box-sizing: border-box; }
        .num-pad { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-top: 10px; }
        .num-btn { background: white; border: 1px solid #DDD; padding: 15px; border-radius: 10px; font-size: 18px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 15px; overflow: hidden; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #EEE; }
        .res-total { font-weight: bold; background: #f8f8f8; }
        button.primary { width: 100%; background: var(--primary); color: white; border: none; padding: 15px; border-radius: 12px; font-size: 16px; font-weight: bold; margin-top: 10px; }
    </style>
</head>
<body>

<div id="view-home" class="view active">
    <h1>Husleje Regnskab</h1>
    <div class="stat-card">
        <div class="stat-label">Resultat i √•r (YTD)</div>
        <div id="dash-ytd" class="stat-value">0 kr.</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Egenkapital (Balance)</div>
        <div id="dash-equity" class="stat-value">0 kr.</div>
    </div>
    <div class="menu-grid">
        <button class="menu-btn" onclick="showView('entry')"><span>‚ûï</span>Kassekladde</button>
        <button class="menu-btn" onclick="showView('report-res')"><span>üìà</span>Resultat</button>
        <button class="menu-btn" onclick="showView('report-bal')"><span>‚öñÔ∏è</span>Balance</button>
        <button class="menu-btn" onclick="showView('accounts')"><span>‚öôÔ∏è</span>Konti / CSV</button>
    </div>
</div>

<div id="view-entry" class="view">
    <h2>Indtast Postering</h2>
    <input type="date" id="entry-date">
    <select id="entry-account"></select>
    <input type="text" id="entry-desc" placeholder="Tekst (f.eks. Maling)">
    <input type="text" id="entry-amount" readonly placeholder="0" style="text-align: right; font-size: 28px; font-weight: bold; color: var(--primary);">
    <div class="num-pad" id="numpad"></div>
    <button class="primary" onclick="saveEntry()">BOGF√òR</button>
    <button onclick="showView('home')" style="width:100%; background:none; border:none; color:gray; margin-top:10px;">Fortryd</button>
</div>

<div id="view-report-res" class="view">
    <h2>Resultatopg√∏relse</h2>
    <table id="res-table"></table>
    <button class="primary" onclick="showView('home')">Tilbage</button>
</div>

<div id="view-report-bal" class="view">
    <h2>Balance</h2>
    <table id="bal-table"></table>
    <button class="primary" onclick="showView('home')">Tilbage</button>
</div>

<div id="view-accounts" class="view">
    <h2>Konti & Eksport</h2>
    <div class="stat-card">
        <input type="text" id="new-acc-name" placeholder="Nyt kontonavn">
        <select id="new-acc-type">
            <option value="Indt√¶gt">Indt√¶gt</option>
            <option value="Udgift">Udgift</option>
            <option value="Aktiv">Aktiv (Bank/Ejendom)</option>
            <option value="Passiv">Passiv (L√•n/Egenkapital)</option>
        </select>
        <button class="primary" onclick="addAccount()">Opret Konto</button>
    </div>
    <div id="acc-list"></div>
    <button class="primary" style="background:var(--success)" onclick="exportCSV()">SEND CSV FIL</button>
    <button onclick="showView('home')" style="width:100%; background:none; border:none; color:gray; margin-top:10px;">Tilbage</button>
</div>

<script>
    let accounts = JSON.parse(localStorage.getItem('house_acc')) || [
        {id: 1, name: "Lejeindt√¶gt", type: "Indt√¶gt"},
        {id: 2, name: "Vedligeholdelse", type: "Udgift"},
        {id: 3, name: "Bank", type: "Aktiv"},
        {id: 4, name: "Egenkapital", type: "Passiv"}
    ];
    let journal = JSON.parse(localStorage.getItem('house_jou')) || [];

    function showView(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById('view-'+id).classList.add('active');
        if(id==='home') updateDash();
        if(id==='entry') renderEntry();
        if(id==='accounts') renderAccounts();
        if(id==='report-res') renderReport('res');
        if(id==='report-bal') renderReport('bal');
    }

    function renderEntry() {
        document.getElementById('entry-date').valueAsDate = new Date();
        document.getElementById('entry-account').innerHTML = accounts.map(a => `<option value="${a.id}">${a.name}</option>`).join('');
        document.getElementById('entry-amount').value = "";
        const pad = document.getElementById('numpad');
        pad.innerHTML = [...Array(9).keys()].map(i => `<button class="num-btn" onclick="press('${i+1}')">${i+1}</button>`).join('') + 
            `<button class="num-btn" onclick="press('C')" style="color:red">C</button><button class="num-btn" onclick="press('0')">0</button><button class="num-btn" onclick="press('.')">.</button>`;
    }

    function press(v) {
        const i = document.getElementById('entry-amount');
        if(v==='C') i.value = ""; else i.value += v;
    }

    function saveEntry() {
        const amt = parseFloat(document.getElementById('entry-amount').value);
        if(!amt) return;
        journal.push({
            date: document.getElementById('entry-date').value,
            accId: parseInt(document.getElementById('entry-account').value),
            desc: document.getElementById('entry-desc').value,
            amount: amt
        });
        localStorage.setItem('house_jou', JSON.stringify(journal));
        showView('home');
    }

    function renderReport(type) {
        const table = document.getElementById(type + '-table');
        let html = `<tr><th>Konto</th><th style="text-align:right">Bel√∏b</th></tr>`;
        let total = 0;
        
        accounts.filter(a => type === 'res' ? (a.type==='Indt√¶gt' || a.type==='Udgift') : (a.type==='Aktiv' || a.type==='Passiv')).forEach(a => {
            const sum = journal.filter(j => j.accId === a.id).reduce((s, j) => s + j.amount, 0);
            html += `<tr><td>${a.name}</td><td style="text-align:right">${sum.toLocaleString()} kr.</td></tr>`;
            if(a.type === 'Indt√¶gt' || a.type === 'Aktiv') total += sum; else total -= sum;
        });
        
        html += `<tr class="res-total"><td>TOTAL</td><td style="text-align:right">${Math.abs(total).toLocaleString()} kr.</td></tr>`;
        table.innerHTML = html;
    }

    function updateDash() {
        let res = 0;
        journal.forEach(j => {
            const a = accounts.find(acc => acc.id === j.accId);
            if(a.type === 'Indt√¶gt') res += j.amount; if(a.type === 'Udgift') res -= j.amount;
        });
        document.getElementById('dash-ytd').innerText = res.toLocaleString() + " kr.";
    }

    function renderAccounts() {
        document.getElementById('acc-list').innerHTML = accounts.map(a => `
            <div style="display:flex; justify-content:space-between; padding:10px; border-bottom:1px solid #ddd;">
                <span>${a.name} (${a.type})</span>
                ${journal.some(j => j.accId === a.id) ? 'üîí' : `<button onclick="delAcc(${a.id})">Slet</button>`}
            </div>`).join('');
    }

    function addAccount() {
        const name = document.getElementById('new-acc-name').value;
        if(!name) return;
        accounts.push({id: Date.now(), name, type: document.getElementById('new-acc-type').value});
        localStorage.setItem('house_acc', JSON.stringify(accounts));
        renderAccounts();
    }

    function delAcc(id) { accounts = accounts.filter(a => a.id !== id); localStorage.setItem('house_acc', JSON.stringify(accounts)); renderAccounts(); }

    function exportCSV() {
        let csv = "\uFEFFDato;Konto;Type;Beskrivelse;Bel√∏b\n";
        journal.forEach(j => {
            const a = accounts.find(acc => acc.id === j.accId);
            csv += `${j.date};${a.name};${a.type};${j.desc};${j.amount}\n`;
        });
        const link = document.createElement("a");
        link.setAttribute("href", encodeURI("data:text/csv;charset=utf-8," + csv));
        link.setAttribute("download", "regnskab.csv");
        link.click();
    }

    updateDash();
</script>
</body>
</html>
